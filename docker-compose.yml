version: '3'
services:
  IngredientMicroservice:
    image: dbitca785/ingredient_service:tagname
    container_name: IngredientMicroservice
    restart: unless-stopped
    depends_on:
      - service_discovery
      - db
    ports:
      - 9191:9191
    networks:
      pad-net:
        ipv4_address: 192.168.0.91
    environment:
      spring.datasource.url: jdbc:postgresql://db:5432/ingredients?createDatabaseIfNotExist=true
      spring.datasource.username: postgres
      spring.datasource.password: postgrespass
      spring.datasource.driverClassName: org.postgresql.Driver
      spring.jpa.database: postgresql
      spring.jpa.hibernate.ddl-auto : create
      spring.jpa.show-sql : true
      server.port: 9191
      service.discovery.url: http://service_discovery:8001/
      spring.application.name: IngredientMicroservice

  RecipeMicroservice:
    image: dbitca785/recipe_service:tagname
    container_name: RecipeMicroservice
    restart: unless-stopped
    depends_on:
      - service_discovery
      - db
    ports:
      - 8081:8081
    networks:
      pad-net:
        ipv4_address: 192.168.0.69
    environment:
      spring.datasource.url : jdbc:postgresql://db:5432/recipes
      spring.datasource.username : postgres
      spring.datasource.password : postgrespass
      spring.jpa.database: postgresql
      spring.jpa.hibernate.ddl-auto : create
      spring.jpa.show-sql : true
      server.port: 8081
      service.discovery.url: http://service_discovery:8001/
      spring.application.name: RecipeMicroservice

  gateway:
      image: gateway:env_test
      container_name: "gateway"
      restart: unless-stopped
      depends_on:
        - service_discovery
        - IngredientMicroservice
        - RecipeMicroservice
      ports:
        - 5000:5000
      environment:
        DISCOVERY_URL: http://service_discovery:8001/
      networks:
        pad-net:
          ipv4_address: 192.168.0.50


  service_discovery:
    image: service-discovery:latest
    container_name: "service_discovery"
    restart: unless-stopped
    ports:
      - 8001:8001
    networks:
      pad-net:
        ipv4_address: 192.168.0.81

  db:
    image: postgres
    restart: always
    environment:
      POSTGRES_PASSWORD: postgrespass
      POSTGRES_USERNAME: postgres
      POSTGRES_DB: recipes
    ports:
      - 5432:5432
    networks:
      pad-net:
        ipv4_address: 192.168.0.54


networks:
  pad-net:
    driver: bridge
    ipam:
      driver: default
      config:
        - subnet: 192.168.0.0/24
